<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EMPIRE CRM - å°Šæ¦®é‚„åŸç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #d4af37; --bg: #0a0a0a; --card-bg: #111111; }
        body { background-color: var(--bg); color: #e0e0e0; font-family: 'Noto Sans TC', sans-serif; }

        /* é‡‘è‰²åœ“åœˆæ•¸é‡æ¨™ç±¤ */
        .count-badge {
            background: #d4af37;
            color: #000;
            font-weight: 900;
            font-size: 1.1rem;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        /* æ‰‹é¢¨ç´æ¡†æ¶ */
        .accordion-item {
            border: 1px solid #222;
            border-radius: 20px;
            margin-bottom: 15px;
            overflow: hidden;
            background: #0f0f0f;
        }

        /* æ¨™é¡Œå€åŸŸ */
        .section-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid #1a1a1a;
        }
        .section-title { font-size: 1.6rem; font-weight: 800; letter-spacing: 2px; }
        .section-subtitle { font-size: 0.8rem; color: #555; margin-left: 10px; letter-spacing: 2px; }

        /* å¡ç‰‡è¨­è¨ˆ */
        .customer-card {
            padding: 20px;
            border-bottom: 1px solid #1a1a1a;
        }
        .card-main { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-name { font-size: 1.5rem; font-weight: 700; color: #fff; }
        .card-value { font-size: 1.3rem; color: var(--gold); font-weight: 900; }
        
        /* å±•é–‹çš„è©³ç´°è³‡è¨Šå€å¡Š */
        .detail-box {
            background: #0a0a0a;
            border-radius: 15px;
            padding: 20px;
            margin-top: 10px;
        }
        .detail-row { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .detail-label { color: #d4af37; font-size: 1.1rem; font-weight: bold; }
        .detail-value { color: #fff; font-size: 1.2rem; font-weight: bold; }

        /* æˆªåœ–ä¸­çš„å¯¦é«”é‡‘è‰²æŒ‰éˆ• */
        .btn-gold {
            background: linear-gradient(180deg, #fde68a 0%, #d4af37 100%);
            color: #000;
            font-weight: 900;
            padding: 12px 20px;
            border-radius: 12px;
            flex: 1;
            text-align: center;
            font-size: 1.1rem;
            box-shadow: 0 4px 0 #8e6d13;
        }
        .btn-gold:active { transform: translateY(2px); box-shadow: 0 2px 0 #8e6d13; }

        .btn-red {
            background: linear-gradient(180deg, #450a0a 0%, #1a0505 100%);
            color: #ef4444;
            border: 1px solid #7f1d1d;
            font-weight: 900;
            padding: 12px 20px;
            border-radius: 12px;
            flex: 1;
            text-align: center;
            font-size: 1.1rem;
        }

        /* è¼¸å…¥æ¡†æ¨£å¼ */
        input, select {
            background: #111 !important;
            border: 1px solid #333 !important;
            color: #fff !important;
            font-size: 1.1rem !important;
            padding: 15px !important;
            border-radius: 12px !important;
        }
    </style>
</head>
<body class="p-4 pb-20">

    <header class="py-8 text-center">
        <h1 class="text-3xl font-black tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-600">EMPIRE CRM</h1>
    </header>

    <div class="accordion-item p-6 mb-10 border-2 border-yellow-900">
        <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
                <label class="text-xs text-yellow-700 block mb-1">éœ€æ±‚é …ç›®</label>
                <input type="text" id="course" placeholder="ä¾‹å¦‚ï¼šé«®è—è¨­è¨ˆ" class="w-full">
            </div>
            <div>
                <label class="text-xs text-yellow-700 block mb-1">é è¨ˆåƒ¹å€¼</label>
                <input type="number" id="value" placeholder="8800" class="w-full">
            </div>
        </div>
        <div class="flex gap-4 items-center">
            <select id="stage" class="flex-[2]">
                <option value="lead">ğŸ†• æ–°é–‹ç™¼éšæ®µ</option>
                <option value="contacted">ğŸ¤ æ´½è«‡ä¸­éšæ®µ</option>
                <option value="won">ğŸ’° å·²æˆäº¤éšæ®µ</option>
            </select>
            <button onclick="saveLead()" class="btn-gold flex-1">å„²å­˜</button>
        </div>
        <div class="mt-4">
            <input type="text" id="name" placeholder="å®¢æˆ¶å§“å" class="w-full mb-2">
            <input type="text" id="contact" placeholder="è¯çµ¡é›»è©±" class="w-full">
        </div>
    </div>

    <div id="kanban-container">
        <div class="accordion-item">
            <div class="section-header" onclick="toggleSection('lead')">
                <div class="flex items-baseline">
                    <span class="section-title text-yellow-600">æ–°é–‹ç™¼</span>
                    <span class="section-subtitle">LEADS</span>
                </div>
                <span id="count-lead" class="count-badge">0</span>
            </div>
            <div id="list-lead" class="p-2 hidden"></div>
        </div>

        <div class="accordion-item">
            <div class="section-header" onclick="toggleSection('contacted')">
                <div class="flex items-baseline">
                    <span class="section-title text-yellow-500">æ´½è«‡ä¸­</span>
                    <span class="section-subtitle">DEALS</span>
                </div>
                <span id="count-contacted" class="count-badge">0</span>
            </div>
            <div id="list-contacted" class="p-2 hidden"></div>
        </div>

        <div class="accordion-item">
            <div class="section-header" onclick="toggleSection('won')">
                <div class="flex items-baseline">
                    <span class="section-title text-green-500">å·²æˆäº¤</span>
                    <span class="section-subtitle">WON</span>
                </div>
                <span id="count-won" class="count-badge">0</span>
            </div>
            <div id="list-won" class="p-2 hidden"></div>
        </div>
    </div>

    <script>
        // Firebase è¨­å®š
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // åˆ‡æ›å±•é–‹/æ”¶åˆ
        function toggleSection(stage) {
            const el = document.getElementById('list-' + stage);
            el.classList.toggle('hidden');
        }

        // è®€å–è³‡æ–™
        db.ref('leads').on('value', (snapshot) => {
            const data = snapshot.val() || {};
            renderUI(data);
        });

        function renderUI(data) {
            const lists = { lead: '', contacted: '', won: '' };
            const counts = { lead: 0, contacted: 0, won: 0 };

            Object.keys(data).forEach(id => {
                const item = data[id];
                const html = `
                    <div class="customer-card">
                        <div class="card-main">
                            <div>
                                <div class="card-name">${item.name || 'åŒ¿å'}</div>
                                <div class="text-xs text-yellow-700 tracking-widest uppercase mt-1">${item.course || 'GENERAL'}</div>
                            </div>
                            <div class="card-value">$${Number(item.value).toLocaleString()} <span class="text-[10px] text-zinc-600">â–¼</span></div>
                        </div>
                        <div class="detail-box">
                            <div class="detail-row">
                                <span class="detail-label">è¯çµ¡æ–¹å¼</span>
                                <span class="detail-value">${item.contact || 'ç„¡'}</span>
                            </div>
                            <div class="flex gap-4">
                                <button class="btn-gold" onclick="alert('é€²å…¥ç·¨è¼¯æ¨¡å¼')">ä¿®æ”¹è³‡è¨Š</button>
                                <button class="btn-red" onclick="deleteLead('${id}')">æ°¸ä¹…åˆªé™¤</button>
                            </div>
                        </div>
                    </div>
                `;
                if (lists[item.stage] !== undefined) {
                    lists[item.stage] += html;
                    counts[item.stage]++;
                }
            });

            ['lead', 'contacted', 'won'].forEach(s => {
                document.getElementById('list-' + s).innerHTML = lists[s] || '<div class="p-4 text-center text-zinc-700 text-sm">å°šç„¡è³‡æ–™</div>';
                document.getElementById('count-' + s).innerText = counts[s];
            });
        }

        function saveLead() {
            const name = document.getElementById('name').value;
            if(!name) { alert("è«‹å¡«å¯«å§“å"); return; }
            
            const newLead = {
                name: name,
                contact: document.getElementById('contact').value,
                course: document.getElementById('course').value,
                value: document.getElementById('value').value || 0,
                stage: document.getElementById('stage').value,
                timestamp: Date.now()
            };
            db.ref('leads').push(newLead).then(() => {
                alert("å„²å­˜æˆåŠŸ");
                document.getElementById('name').value = '';
                document.getElementById('contact').value = '';
            });
        }

        function deleteLead(id) {
            if(confirm('ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é€™ç­†å°Šæ¦®ç´€éŒ„å—ï¼Ÿ')) {
                db.ref('leads').child(id).remove();
            }
        }
    </script>
</body>
</html>
