<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EMPIRE CRM - ç©©å®šæµé‡‘ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold-bright: #fde68a; --gold-main: #d4af37; --gold-dark: #8e6d13; }
        body { background-color: #050505; color: var(--gold-main); font-family: 'Noto Sans TC', sans-serif; }
        
        .text-gradient-gold {
            background: linear-gradient(to bottom, #fff6d5 0%, #d4af37 50%, #8e6d13 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .glass-card {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 24px;
        }

        /* å„²å­˜æŒ‰éˆ•é»æ“Šå‹•ç•« */
        .gold-btn-solid {
            background: linear-gradient(to bottom, #fde68a, #d4af37);
            color: #1a1100; font-weight: 900; padding: 16px;
            border-radius: 14px; text-align: center; display: block; width: 100%;
            transition: transform 0.1s, opacity 0.2s;
            cursor: pointer; border: none;
        }
        .gold-btn-solid:active { transform: scale(0.96); opacity: 0.9; }

        input, select {
            background: rgba(0,0,0,0.5) !important;
            border: 1px solid var(--gold-dark) !important;
            color: var(--gold-bright) !important;
            padding: 16px !important; border-radius: 14px !important; width: 100%;
        }
    </style>
</head>
<body class="p-5 pb-24">

    <header class="py-10 text-center">
        <h1 class="text-4xl font-black text-gradient-gold tracking-widest">EMPIRE CRM</h1>
        <p id="status-text" class="text-[10px] text-yellow-900 mt-2 font-bold uppercase">ç³»çµ±é€£ç·šä¸­...</p>
    </header>

    <div class="glass-card p-6 mb-10 border-2 border-yellow-900/30">
        <h2 class="text-lg font-bold mb-5 text-gradient-gold">ï¼‹ å°Šæ¦®å®¢æˆ¶ç™»éŒ„</h2>
        <div class="space-y-4">
            <input type="text" id="name" placeholder="å®¢æˆ¶å°Šç¨± (å¿…å¡«)">
            <input type="text" id="contact" placeholder="è¯çµ¡è³‡è¨Š (é›»è©±/LINE)">
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="course" placeholder="éœ€æ±‚é …ç›®">
                <input type="number" id="value" placeholder="é ç®—é‡‘é¡">
            </div>
            <select id="stage">
                <option value="lead">æ–°é–‹ç™¼éšæ®µ (LEAD)</option>
                <option value="contacted">æ´½è«‡ä¸­éšæ®µ (DEAL)</option>
                <option value="won">æˆäº¤ç´€éŒ„ (WON)</option>
            </select>
            <button onclick="handleSave()" class="gold-btn-solid">ç¢ºèªå¯«å…¥è³‡æ–™åº«</button>
        </div>
    </div>

    <div id="kanban" class="space-y-4">
        </div>

    <script>
        // 1. è«‹åœ¨æ­¤å¡«å¯«æ‚¨çš„æ­£ç¢ºé…ç½®
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCOhBN9TH3UJSOSx5XVyQ08f_2RUckvXYU",
  authDomain: "holyhairsalon-f73bf.firebaseapp.com",
  databaseURL: "https://holyhairsalon-f73bf-default-rtdb.firebaseio.com",
  projectId: "holyhairsalon-f73bf",
  storageBucket: "holyhairsalon-f73bf.firebasestorage.app",
  messagingSenderId: "960169055224",
  appId: "1:960169055224:web:82244b5e65983f89bf3c0d",
  measurementId: "G-XS22B43TYM"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        // 2. åˆå§‹åŒ–æª¢æŸ¥
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            document.getElementById('status-text').innerText = "ğŸŸ¢ ç³»çµ±å·²å°±ç·’ (é›²ç«¯æ¨¡å¼)";
        } catch (e) {
            document.getElementById('status-text').innerText = "ğŸ”´ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Config";
            console.error(e);
        }

        // 3. å„²å­˜å‡½æ•¸ (æ”¹åç‚º handleSave é¿å…è¡çª)
        function handleSave() {
            const nameEl = document.getElementById('name');
            const contactEl = document.getElementById('contact');
            const courseEl = document.getElementById('course');
            const valueEl = document.getElementById('value');
            const stageEl = document.getElementById('stage');

            if (!nameEl.value) {
                alert("è«‹è¼¸å…¥å®¢æˆ¶å°Šç¨±");
                return;
            }

            const payload = {
                name: nameEl.value,
                contact: contactEl.value,
                course: courseEl.value || "ä¸€èˆ¬è«®è©¢",
                value: valueEl.value || 0,
                stage: stageEl.value,
                time: Date.now()
            };

            // åŸ·è¡Œå¯«å…¥
            db.ref('leads').push(payload)
                .then(() => {
                    alert("âœ¨ è³‡æ–™å·²æˆåŠŸå¯«å…¥é›²ç«¯");
                    // æ¸…ç©ºè¼¸å…¥æ¡†
                    nameEl.value = '';
                    contactEl.value = '';
                    courseEl.value = '';
                    valueEl.value = '';
                })
                .catch((error) => {
                    alert("âŒ å„²å­˜å¤±æ•—ï¼š" + error.message);
                    console.error(error);
                });
        }

        // 4. å³æ™‚æ¸²æŸ“çœ‹æ¿ (ç°¡åŒ–ç‰ˆç¢ºä¿ç©©å®š)
        db.ref('leads').on('value', (snapshot) => {
            const data = snapshot.val() || {};
            const kanban = document.getElementById('kanban');
            kanban.innerHTML = ''; // æ¸…ç©º

            const stages = { lead: 'æ–°é–‹ç™¼', contacted: 'æ´½è«‡ä¸­', won: 'å·²æˆäº¤' };
            
            for (let s in stages) {
                const filtered = Object.keys(data).filter(id => data[id].stage === s);
                let html = `
                    <div class="glass-card p-5">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xl font-bold text-gradient-gold">${stages[s]}</span>
                            <span class="bg-yellow-600 text-black px-2 py-1 rounded-md font-black text-sm">${filtered.length}</span>
                        </div>
                        <div class="space-y-3">
                `;

                filtered.forEach(id => {
                    const item = data[id];
                    html += `
                        <div class="bg-black/30 p-4 rounded-xl border border-yellow-900/20">
                            <div class="flex justify-between items-center">
                                <span class="text-white text-lg font-bold">${item.name}</span>
                                <span class="text-gradient-gold font-black">$${Number(item.value).toLocaleString()}</span>
                            </div>
                            <div class="text-xs text-yellow-800 mt-1 uppercase tracking-tighter">${item.course} | ${item.contact}</div>
                            <button onclick="deleteItem('${id}')" class="text-[10px] text-red-900 mt-2 font-bold">ç§»é™¤ç´€éŒ„</button>
                        </div>
                    `;
                });

                html += `</div></div>`;
                kanban.innerHTML += html;
            }
        });

        function deleteItem(id) {
            if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) db.ref('leads').child(id).remove();
        }
    </script>
</body>
</html>

