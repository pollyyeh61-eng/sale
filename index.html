<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EMPIRE CRM - LUXURY EDITION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;900&display=swap');

        :root { 
            --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --deep-bg: #050505;
            --glass-bg: rgba(25, 25, 25, 0.6);
            --text-gold: #d4af37;
            --bright-gold: #f9d976;
        }

        body { 
            background-color: var(--deep-bg); 
            background-image: radial-gradient(circle at 50% -20%, #1a1a1a 0%, #050505 80%);
            color: var(--text-gold); 
            font-family: 'Noto Sans TC', sans-serif;
            min-height: 100vh;
        }

        /* æ¼¸å±¤é‡‘å±¬å­— */
        .gold-text-gradient {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
            font-weight: 900;
        }

        /* æ¯›ç»ç’ƒå¡ç‰‡ */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }

        /* å‘¼å¸ç™¼å…‰é‚Šæ¡† */
        .breath-border {
            border: 1px solid var(--text-gold);
            animation: breathe 4s infinite ease-in-out;
        }
        @keyframes breathe {
            0%, 100% { border-color: rgba(191, 149, 63, 0.3); box-shadow: 0 0 5px rgba(191, 149, 63, 0.1); }
            50% { border-color: rgba(251, 245, 183, 0.8); box-shadow: 0 0 15px rgba(251, 245, 183, 0.2); }
        }

        .gold-btn {
            background: var(--gold-gradient);
            color: #000;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            border: none;
        }
        .gold-btn:active { transform: scale(0.95); filter: brightness(1.2); }

        /* é¢¨ç´å¼æŠ½å±œ */
        .accordion-content { overflow: hidden; max-height: 0; transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .accordion-item.open .accordion-content { max-height: 400px; padding: 15px; border-top: 1px solid rgba(212, 175, 55, 0.1); }
        .accordion-item.open { background: rgba(212, 175, 55, 0.05); }

        /* è¼¸å…¥æ¡†ç¾åŒ– */
        input, select {
            background: rgba(0, 0, 0, 0.4) !important;
            border: 1px solid rgba(212, 175, 55, 0.3) !important;
            color: var(--bright-gold) !important;
            outline: none !important;
        }
        input:focus { border-color: var(--bright-gold) !important; box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
        
        ::placeholder { color: rgba(212, 175, 55, 0.4); }

        /* é¢æ¿å¤§æ¨™é¡Œ */
        .panel-title {
            font-size: 1.2rem;
            letter-spacing: 2px;
            font-weight: 900;
            color: var(--bright-gold);
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body class="p-4 pb-20">

    <header class="text-center py-6">
        <h1 class="text-3xl gold-text-gradient tracking-[0.2em]">EMPIRE SALES</h1>ç¾æ¥­éŠ·å”®é–‹ç™¼ç³»çµ±<p class="text-[10px] text-yellow-800 tracking-[0.5em] mt-1 font-bold">pp
    </header>

    <section class="mb-8">
        <div class="glass-card breath-border rounded-2xl p-5">
            <div id="match-hint" class="hidden text-[10px] text-white bg-yellow-600/50 px-2 py-1 rounded-full w-fit mb-3 animate-pulse">
                âœ¨ å·²ç‚ºæ‚¨æå–æ­·å²å°Šæ¦®è¨˜éŒ„
            </div>
            <form id="lead-form" class="space-y-4">
                <input type="hidden" id="edit-id">
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-1">
                        <label class="text-[10px] ml-1 opacity-70">å®¢æˆ¶åç¨±</label>
                        <input type="text" id="name" placeholder="ç‹å°æ˜" required class="p-3 rounded-xl w-full">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] ml-1 opacity-70">è¯çµ¡è³‡è¨Š</label>
                        <input type="text" id="contact" placeholder="LINE / TEL" required class="p-3 rounded-xl w-full">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-1">
                        <label class="text-[10px] ml-1 opacity-70">éœ€æ±‚é …ç›®</label>
                        <input type="text" id="course" placeholder="é«®è—è¨­è¨ˆ" class="p-3 rounded-xl w-full">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] ml-1 opacity-70">é è¨ˆåƒ¹å€¼</label>
                        <input type="number" id="value" placeholder="8800" class="p-3 rounded-xl w-full">
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <select id="stage" class="p-3 rounded-xl flex-1 font-bold">
                        <option value="lead">ğŸ†• æ–°é–‹ç™¼éšæ®µ</option>
                        <option value="contacted">ğŸ’¬ æ·±å…¥æ´½è«‡ä¸­</option>
                        <option value="won">ğŸ† æˆåŠŸçµæ¡ˆ</option>
                    </select>
                    <button type="submit" id="submit-btn" class="gold-btn px-8 py-3 rounded-xl shadow-[0_0_20px_rgba(191,149,63,0.3)]">å„²å­˜</button>
                </div>
                <button type="button" id="cancel-edit" class="hidden w-full text-[10px] text-white/40 tracking-widest pt-2">å–æ¶ˆä¿®æ”¹æ¨¡å¼</button>
            </form>
        </div>
    </section>

    <main class="space-y-6">
        <div class="glass-card rounded-2xl overflow-hidden">
            <div class="p-4 border-b border-yellow-900/30 flex justify-between items-center">
                <span class="panel-title">æ–°é–‹ç™¼ <span class="text-xs opacity-50 ml-1">LEADS</span></span>
                <span id="count-lead" class="bg-yellow-600 text-black text-[10px] font-black px-2 py-0.5 rounded-full">0</span>
            </div>
            <div id="list-lead"></div>
        </div>

        <div class="glass-card rounded-2xl overflow-hidden">
            <div class="p-4 border-b border-yellow-900/30 flex justify-between items-center">
                <span class="panel-title">æ´½è«‡ä¸­ <span class="text-xs opacity-50 ml-1">DEALS</span></span>
                <span id="count-contacted" class="bg-yellow-600 text-black text-[10px] font-black px-2 py-0.5 rounded-full">0</span>
            </div>
            <div id="list-contacted"></div>
        </div>

        <div class="glass-card rounded-2xl overflow-hidden">
            <div class="p-4 border-b border-yellow-900/30 flex justify-between items-center">
                <span class="panel-title">å·²æˆäº¤ <span class="text-xs opacity-50 ml-1">WON</span></span>
                <span id="count-won" class="bg-yellow-600 text-black text-[10px] font-black px-2 py-0.5 rounded-full">0</span>
            </div>
            <div id="list-won"></div>
        </div>
    </main>

    <script>
        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyCOhBN9TH3UJSOSx5XVyQ08f_2RUckvXYU",
            authDomain: "holyhairsalon-f73bf.firebaseapp.com",
            databaseURL: "https://holyhairsalon-f73bf-default-rtdb.firebaseio.com",
            projectId: "holyhairsalon-f73bf",
            storageBucket: "holyhairsalon-f73bf.firebasestorage.app",
            messagingSenderId: "960169055224",
            appId: "1:960169055224:web:82244b5e65983f89bf3c0d",
            measurementId: "G-XS22B43TYM"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const leadsRef = db.ref('leads');

        let localData = {};

        // æ™ºæ…§åµæ¸¬ï¼šåŒåè‡ªå‹•å¡«å…¥
        document.getElementById('name').addEventListener('input', function(e) {
            const val = e.target.value.trim();
            if (!val) { hideHint(); return; }
            const match = Object.values(localData).find(item => item.name === val);
            if (match && !document.getElementById('edit-id').value) {
                document.getElementById('contact').value = match.contact;
                document.getElementById('course').value = match.course || "";
                document.getElementById('value').value = match.value || "";
                document.getElementById('stage').value = match.stage;
                showHint();
            } else { hideHint(); }
        });

        function showHint() { document.getElementById('match-hint').classList.remove('hidden'); }
        function hideHint() { document.getElementById('match-hint').classList.add('hidden'); }

        // å„²å­˜é‚è¼¯
        document.getElementById('lead-form').onsubmit = function(e) {
            e.preventDefault();
            const editId = document.getElementById('edit-id').value;
            const id = editId || 'L' + Date.now();
            
            const leadData = {
                id: id,
                name: document.getElementById('name').value.trim(),
                contact: document.getElementById('contact').value.trim(),
                stage: document.getElementById('stage').value,
                course: document.getElementById('course').value,
                value: document.getElementById('value').value || 0,
                updatedAt: Date.now()
            };

            leadsRef.child(id).set(leadData).then(() => {
                this.reset();
                document.getElementById('edit-id').value = "";
                document.getElementById('submit-btn').innerText = "å„²å­˜";
                document.getElementById('cancel-edit').classList.add('hidden');
                hideHint();
            });
        };

        // ç›£è½é›²ç«¯æ•¸æ“š
        leadsRef.on('value', (snapshot) => {
            localData = snapshot.val() || {};
            renderUI();
        });

        function renderUI() {
            const stages = ['lead', 'contacted', 'won'];
            stages.forEach(s => {
                const listEl = document.getElementById('list-' + s);
                const countEl = document.getElementById('count-' + s);
                listEl.innerHTML = "";
                const filtered = Object.values(localData).filter(i => i.stage === s).sort((a,b) => b.updatedAt - a.updatedAt);
                countEl.innerText = filtered.length;

                filtered.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "accordion-item border-b border-yellow-900/10 last:border-0";
                    div.innerHTML = `
                        <div class="p-4 flex justify-between items-center cursor-pointer active:bg-white/5" onclick="toggleAccordion(this)">
                            <div>
                                <span class="font-bold text-yellow-100">${item.name}</span>
                                <div class="text-[10px] text-yellow-700 font-bold uppercase tracking-widest mt-0.5">${item.course || 'GENERAL'}</div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="font-black text-sm text-yellow-500 font-mono tracking-tighter">$${Number(item.value).toLocaleString()}</span>
                                <span class="chevron text-[10px] text-yellow-800 transition-transform">â–¼</span>
                            </div>
                        </div>
                        <div class="accordion-content">
                            <div class="bg-black/40 rounded-xl p-4 space-y-4">
                                <div class="grid grid-cols-2 gap-2 text-xs">
                                    <div class="text-yellow-800 font-bold">è¯çµ¡æ–¹å¼</div>
                                    <div class="text-yellow-100">${item.contact}</div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="editItem('${item.id}')" class="flex-1 py-2 bg-yellow-600 text-black font-black text-[10px] rounded-lg">ä¿®æ”¹è³‡è¨Š</button>
                                    <button onclick="deleteItem('${item.id}')" class="flex-1 py-2 bg-red-950 text-red-500 font-black text-[10px] rounded-lg border border-red-900/30">æ°¸ä¹…åˆªé™¤</button>
                                </div>
                            </div>
                        </div>
                    `;
                    listEl.appendChild(div);
                });
            });
        }

        function toggleAccordion(header) {
            const item = header.parentElement;
            const isOpen = item.classList.contains('open');
            document.querySelectorAll('.accordion-item').forEach(i => i.classList.remove('open'));
            if (!isOpen) item.classList.add('open');
        }

        function editItem(id) {
            const item = localData[id];
            document.getElementById('edit-id').value = id;
            document.getElementById('name').value = item.name;
            document.getElementById('contact').value = item.contact;
            document.getElementById('course').value = item.course;
            document.getElementById('value').value = item.value;
            document.getElementById('stage').value = item.stage;
            document.getElementById('submit-btn').innerText = "æ›´æ–°";
            document.getElementById('cancel-edit').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteItem(id) {
            if(confirm('ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é€™ç­†å°Šæ¦®ç´€éŒ„å—ï¼Ÿ')) { leadsRef.child(id).remove(); }
        }

        document.getElementById('cancel-edit').onclick = function() {
            document.getElementById('lead-form').reset();
            document.getElementById('edit-id').value = "";
            this.classList.add('hidden');
            document.getElementById('submit-btn').innerText = "å„²å­˜";
        };
    </script>
</body>
</html>

