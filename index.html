<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EMPIRE CRM - 大字強化版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root { --gold: #d4af37; --dark-gold: #8e6d13; --bg: #0a0a0a; --card-bg: #161616; }
        body { background-color: var(--bg); color: #e0e0e0; font-family: 'Noto Sans TC', sans-serif; }

        /* 右上角數量：放大並強化視覺 */
        .count-badge {
            background: linear-gradient(135deg, #fde68a, var(--gold));
            color: #000;
            font-weight: 900;
            font-size: 1.1rem; /* 放大字體 */
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.6);
        }

        /* 看板標題放大 */
        .column-title { font-size: 1.5rem; font-weight: 800; letter-spacing: 1px; }

        /* 卡片文字放大 */
        .customer-card { 
            background: var(--card-bg); 
            border: 1px solid #333; 
            border-radius: 16px; 
            padding: 1.5rem; 
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .card-name { font-size: 1.3rem; font-weight: 700; color: #fff; }
        .card-value { font-size: 1.1rem; color: var(--gold); font-weight: 900; }

        /* 彈窗（點開後）字體極大化 */
        #details-modal h2 { font-size: 2.2rem; }
        .modal-label { font-size: 1rem; color: #888; letter-spacing: 2px; text-transform: uppercase; }
        .modal-info { font-size: 1.6rem; color: #fff; font-weight: 600; margin-top: 4px; }
        .modal-price { font-size: 2.2rem; color: var(--gold); font-weight: 900; }

        .gold-btn {
            background: linear-gradient(135deg, var(--dark-gold), var(--gold));
            color: #000; font-weight: 900; font-size: 1.2rem;
            padding: 1rem; border-radius: 12px;
        }
        
        /* 增加手機捲動間距 */
        .kanban-column { flex: 0 0 88vw; margin-right: 1rem; background: #111; border-radius: 24px; padding: 1.5rem; }
    </style>
</head>
<body class="pb-20">

    <header class="p-8 text-center">
        <h1 class="text-3xl font-black tracking-[0.2em] text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-600">EMPIRE CRM</h1>
        <p id="conn-status" class="text-xs text-yellow-900 mt-2 font-bold uppercase">System Priority: High Visibility</p>
    </header>

    <div class="px-5 mb-8">
        <details class="border-2 border-yellow-800 rounded-2xl p-5 bg-zinc-950">
            <summary class="text-yellow-500 font-black text-center list-none text-lg">＋ 快速登錄資料</summary>
            <form id="lead-form" class="mt-6 space-y-4">
                <input type="text" id="name" placeholder="客戶姓名" required class="w-full p-4 rounded-xl bg-zinc-900 border border-zinc-700 text-white text-lg">
                <input type="text" id="contact" placeholder="電話 / LINE ID" required class="w-full p-4 rounded-xl bg-zinc-900 border border-zinc-700 text-white text-lg">
                <select id="stage" class="w-full p-4 rounded-xl bg-zinc-900 border border-zinc-700 text-white text-lg">
                    <option value="lead">新開發 (Lead)</option>
                    <option value="contacted">洽談中 (Contacted)</option>
                    <option value="won">已成交 (Won)</option>
                </select>
                <div class="grid grid-cols-2 gap-3">
                    <input type="text" id="course" placeholder="項目" class="p-4 rounded-xl bg-zinc-900 border border-zinc-700 text-white text-lg">
                    <input type="number" id="value" placeholder="預算" class="p-4 rounded-xl bg-zinc-900 border border-zinc-700 text-white text-lg">
                </div>
                <button type="submit" class="gold-btn w-full shadow-2xl">確認儲存</button>
            </form>
        </details>
    </div>

    <div class="flex overflow-x-auto px-5 pb-10 snap-x snap-mandatory">
        <div class="kanban-column snap-center" data-stage="lead">
            <div class="flex justify-between items-center mb-6">
                <span class="column-title text-yellow-600">新開發</span>
                <span id="count-lead" class="count-badge">0</span>
            </div>
            <div id="lead-list" class="stage-list min-h-[400px]"></div>
        </div>
        <div class="kanban-column snap-center" data-stage="contacted">
            <div class="flex justify-between items-center mb-6">
                <span class="column-title text-yellow-500">洽談中</span>
                <span id="count-contacted" class="count-badge">0</span>
            </div>
            <div id="contacted-list" class="stage-list min-h-[400px]"></div>
        </div>
        <div class="kanban-column snap-center" data-stage="won">
            <div class="flex justify-between items-center mb-6">
                <span class="column-title text-green-500">已成交</span>
                <span id="count-won" class="count-badge">0</span>
            </div>
            <div id="won-list" class="stage-list min-h-[400px]"></div>
        </div>
    </div>

    <div id="details-modal" class="hidden fixed inset-0 z-50 bg-black/95 backdrop-blur-xl flex items-center justify-center p-6">
        <div class="bg-zinc-900 border-2 border-yellow-600 w-full max-w-sm rounded-[32px] p-8">
            <h2 id="m-name" class="text-white font-black mb-8 border-b border-zinc-800 pb-4"></h2>
            <div class="space-y-8">
                <div>
                    <div class="modal-label">聯絡資訊</div>
                    <div id="m-contact" class="modal-info"></div>
                </div>
                <div>
                    <div class="modal-label">預約項目</div>
                    <div id="m-course" class="modal-info text-yellow-100"></div>
                </div>
                <div>
                    <div class="modal-label">預估金額</div>
                    <div id="m-value" class="modal-price"></div>
                </div>
            </div>
            <div class="mt-12 flex gap-4">
                <button onclick="closeModal()" class="flex-1 py-5 rounded-2xl bg-zinc-800 text-white font-bold text-xl">關閉</button>
                <button id="m-delete" class="px-6 py-5 rounded-2xl bg-red-900/30 text-red-500 font-bold">刪除</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const leadsRef = db.ref('leads');

        // 讀取並渲染
        leadsRef.on('value', (s) => {
            const data = s.val() || {};
            renderUI(data);
        });

        function renderUI(data) {
            document.querySelectorAll('.stage-list').forEach(el => el.innerHTML = '');
            const counts = { lead: 0, contacted: 0, won: 0 };

            Object.keys(data).forEach(id => {
                const item = data[id];
                const card = document.createElement('div');
                card.className = 'customer-card';
                card.onclick = () => openModal(id, item);
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="card-name">${item.name}</span>
                        <span class="card-value">$${Number(item.value).toLocaleString()}</span>
                    </div>
                    <div class="text-xs text-zinc-500 mt-2 tracking-widest">${item.course || 'GENERAL'}</div>
                `;
                const list = document.getElementById(`${item.stage}-list`);
                if(list) {
                    list.appendChild(card);
                    counts[item.stage]++;
                }
            });

            // 更新右上角數量標籤
            document.getElementById('count-lead').innerText = counts.lead;
            document.getElementById('count-contacted').innerText = counts.contacted;
            document.getElementById('count-won').innerText = counts.won;
        }

        // 寫入
        document.getElementById('lead-form').onsubmit = function(e) {
            e.preventDefault();
            const id = 'l_' + Date.now();
            const newLead = {
                id,
                name: document.getElementById('name').value,
                contact: document.getElementById('contact').value,
                stage: document.getElementById('stage').value,
                course: document.getElementById('course').value,
                value: document.getElementById('value').value || 0
            };
            leadsRef.child(id).set(newLead);
            this.reset();
            document.querySelector('details').open = false;
        };

        function openModal(id, item) {
            document.getElementById('m-name').innerText = item.name;
            document.getElementById('m-contact').innerText = item.contact;
            document.getElementById('m-course').innerText = item.course || '未填寫';
            document.getElementById('m-value').innerText = `$ ${Number(item.value).toLocaleString()}`;
            document.getElementById('m-delete').onclick = () => {
                if(confirm('確定刪除？')) { leadsRef.child(id).remove(); closeModal(); }
            };
            document.getElementById('details-modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('details-modal').classList.add('hidden'); }

        // 拖拽
        document.querySelectorAll('.stage-list').forEach(list => {
            new Sortable(list, {
                group: 'kanban', animation: 150,
                onEnd: (evt) => {
                    const id = evt.item.onclick.toString().match(/'(.*?)'/)[1];
                    const newStage = evt.to.parentElement.dataset.stage;
                    leadsRef.child(id).update({ stage: newStage });
                }
            });
        });
    </script>
</body>
</html>
