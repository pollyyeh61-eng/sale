<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EMPIRE CRM - HOLY HAIR é™å®šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root { 
            --gold-bright: #fde68a; 
            --gold-main: #d4af37; 
            --gold-dark: #8e6d13;
            --bg-black: #050505;
        }
        
        body { 
            background-color: var(--bg-black); 
            color: var(--gold-main); 
            font-family: 'Noto Sans TC', sans-serif; 
            background-image: radial-gradient(circle at top right, #1a150a, transparent);
            min-height: 100vh;
        }

        /* æ¼¸å±¤é‡‘å±¬å­—é«” */
        .text-gradient-gold {
            background: linear-gradient(to bottom, #fff6d5 0%, #d4af37 50%, #8e6d13 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* æ¯›ç»ç’ƒè³ªæ„Ÿå¡ç‰‡ */
        .glass-card {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 24px;
        }

        /* æµå‹•é‡‘å…‰é‚Šæ¡† */
        .flow-border {
            position: relative;
            padding: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-main), transparent);
            background-size: 200% 100%;
            animation: flow 4s linear infinite;
            border-radius: 24px;
        }
        @keyframes flow {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* å¯¦é«”é‡‘å±¬å„²å­˜æŒ‰éˆ• */
        #btn-save {
            background: linear-gradient(to bottom, #fde68a, #d4af37);
            color: #1a1100;
            font-weight: 900;
            padding: 18px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            width: 100%;
            border: none;
            font-size: 1.1rem;
            transition: transform 0.1s;
        }
        #btn-save:active { transform: scale(0.96); opacity: 0.9; }

        input, select {
            background: rgba(0,0,0,0.5) !important;
            border: 1px solid var(--gold-dark) !important;
            color: var(--gold-bright) !important;
            padding: 16px !important;
            border-radius: 14px !important;
            width: 100%;
            outline: none;
        }
    </style>
</head>
<body class="p-5 pb-24">

    <header class="py-8 text-center">
        <h1 class="text-4xl font-black text-gradient-gold tracking-widest">EMPIRE CRM</h1>
        <p id="sync-status" class="text-[10px] text-yellow-900 mt-2 font-bold uppercase tracking-tighter">Connecting to HolyHair Cloud...</p>
    </header>

    <div class="flow-border mb-10">
        <div class="glass-card p-6">
            <h2 class="text-lg font-bold mb-5 text-gradient-gold text-center">ï¼‹ å°Šæ¦®å®¢æˆ¶ç™»éŒ„</h2>
            <div class="space-y-4">
                <input type="text" id="ipt-name" placeholder="å®¢æˆ¶å°Šç¨± (å¿…å¡«)">
                <input type="text" id="ipt-contact" placeholder="è¯çµ¡è³‡è¨Š (é›»è©±/LINE)">
                <div class="grid grid-cols-2 gap-3">
                    <input type="text" id="ipt-course" placeholder="éœ€æ±‚é …ç›®">
                    <input type="number" id="ipt-value" placeholder="é ç®—é‡‘é¡">
                </div>
                <select id="ipt-stage">
                    <option value="lead">æ–°é–‹ç™¼éšæ®µ (LEAD)</option>
                    <option value="contacted">æ´½è«‡ä¸­éšæ®µ (DEAL)</option>
                    <option value="won">æˆäº¤ç´€éŒ„ (WON)</option>
                </select>
                <button id="btn-save">ç¢ºèªå¯«å…¥è³‡æ–™åº«</button>
            </div>
        </div>
    </div>

    <div id="kanban-display" class="space-y-6"></div>

    <script>
        // ç­‰å¾…é é¢èˆ‡ SDK è¼‰å…¥
        window.addEventListener('load', function() {
            
            // 1. å·²æ¤å…¥æ‚¨çš„ Firebase é‡‘é‘°
            const firebaseConfig = {
                apiKey: "AIzaSyCOhBN9TH3UJSOSx5XVyQ08f_2RUckvXYU",
                authDomain: "holyhairsalon-f73bf.firebaseapp.com",
                databaseURL: "https://holyhairsalon-f73bf-default-rtdb.firebaseio.com",
                projectId: "holyhairsalon-f73bf",
                storageBucket: "holyhairsalon-f73bf.firebasestorage.app",
                messagingSenderId: "960169055224",
                appId: "1:960169055224:web:82244b5e65983f89bf3c0d",
                measurementId: "G-XS22B43TYM"
            };

            // 2. åˆå§‹åŒ–
            let database;
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                database = firebase.database();
                document.getElementById('sync-status').innerText = "ğŸŸ¢ HOLY HAIR é›²ç«¯åŒæ­¥ä¸­";
            } catch (e) {
                document.getElementById('sync-status').innerText = "ğŸ”´ é€£ç·šå¤±æ•—ï¼šè«‹æª¢æŸ¥ç¶²è·¯";
            }

            // 3. å„²å­˜é»æ“Šç›£è½ (ä½¿ç”¨æ›´ç©©å®šçš„ EventListener)
            const saveBtn = document.getElementById('btn-save');
            saveBtn.addEventListener('click', function() {
                const name = document.getElementById('ipt-name').value;
                if (!name) { alert("è«‹è¼¸å…¥å®¢æˆ¶å°Šç¨±"); return; }

                const data = {
                    name: name,
                    contact: document.getElementById('ipt-contact').value || "æœªæä¾›",
                    course: document.getElementById('ipt-course').value || "å°ˆå±¬è¨­è¨ˆ",
                    value: document.getElementById('ipt-value').value || 0,
                    stage: document.getElementById('ipt-stage').value,
                    timestamp: Date.now()
                };

                saveBtn.disabled = true;
                saveBtn.innerText = "åŒæ­¥ä¸­...";

                database.ref('leads').push(data)
                    .then(() => {
                        alert("âœ¨ è³‡æ–™å·²å®‰å…¨å­˜å„²");
                        document.getElementById('ipt-name').value = '';
                        document.getElementById('ipt-contact').value = '';
                        document.getElementById('ipt-course').value = '';
                        document.getElementById('ipt-value').value = '';
                    })
                    .catch(err => alert("å¤±æ•—ï¼š" + err.message))
                    .finally(() => {
                        saveBtn.disabled = false;
                        saveBtn.innerText = "ç¢ºèªå¯«å…¥è³‡æ–™åº«";
                    });
            });

            // 4. æ¸²æŸ“çœ‹æ¿ (ç²¾å“å­—é«”èˆ‡æ’ç‰ˆ)
            database.ref('leads').on('value', (snapshot) => {
                const val = snapshot.val() || {};
                const display = document.getElementById('kanban-display');
                display.innerHTML = '';

                const stages = { lead: 'æ–°é–‹ç™¼', contacted: 'æ´½è«‡ä¸­', won: 'å·²æˆäº¤' };
                
                for (let s in stages) {
                    const items = Object.keys(val).filter(id => val[id].stage === s);
                    let html = `
                        <div class="glass-card p-6">
                            <div class="flex justify-between items-center mb-5">
                                <span class="text-2xl font-black text-gradient-gold">${stages[s]}</span>
                                <span class="bg-yellow-600 text-black px-3 py-1 rounded-lg font-black text-sm">${items.length}</span>
                            </div>
                            <div class="space-y-4">
                    `;

                    items.forEach(id => {
                        const item = val[id];
                        html += `
                            <div class="bg-black/30 p-5 rounded-2xl border border-yellow-900/10">
                                <div class="flex justify-between items-start">
                                    <div class="text-2xl font-bold text-white">${item.name}</div>
                                    <div class="text-2xl font-black text-gradient-gold">$${Number(item.value).toLocaleString()}</div>
                                </div>
                                <div class="text-sm text-yellow-800 mt-2 font-bold tracking-wider">${item.course} | ${item.contact}</div>
                                <div class="mt-4 flex justify-end">
                                    <button onclick="removeItem('${id}')" class="text-[10px] text-red-900 font-bold border border-red-900/30 px-2 py-1 rounded">ç§»é™¤</button>
                                </div>
                            </div>
                        `;
                    });

                    html += `</div></div>`;
                    display.innerHTML += html;
                }
            });
        });

        function removeItem(id) {
            if(confirm('ç¢ºå®šç§»é™¤æ­¤ç­†ç´€éŒ„ï¼Ÿ')) firebase.database().ref('leads').child(id).remove();
        }
    </script>
</body>
</html>
